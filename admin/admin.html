<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Админ-панель</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="background"></div>
    <div class="login-container" id="login-container">
        <h1>Вход в админку</h1>
        <form id="login-form">
            <div class="input-group">
                <label for="username">Логин:</label>
                <input type="text" id="username" name="username" required>
            </div>
            <div class="input-group">
                <label for="password">Пароль:</label>
                <input type="password" id="password" name="password" required>
            </div>
            <button type="submit">Войти</button>
        </form>
        <p id="error-message" style="color: red; display: none;">Неверный логин или пароль!</p>
    </div>

    <div class="admin-container" id="admin-container" style="display: none;">
        <h1>Заказы</h1>
        <div class="table-wrapper">
            <table id="orders-table">
                <thead>
                    <tr>
                        <th>Имя</th>
                        <th>Discord</th>
                        <th>Email</th>
                        <th>Заказ</th>
                        <th>Сумма</th>
                        <th>Дата</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Сюда будут вставляться заказы -->
                </tbody>
            </table>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const loginContainer = document.getElementById('login-container');
            const adminContainer = document.getElementById('admin-container');
            const loginForm = document.getElementById('login-form');
            const errorMessage = document.getElementById('error-message');

            // Сохранённые хеши логина и пароля (логин: "***", пароль: "***")
            const ADMIN_USERNAME_HASH = "8c6976e5b5410415bde908bd4dee15dfb167a9c873fc4bb8a81f6f2ab448a918";
            const ADMIN_PASSWORD_HASH = "240be518fabd2724ddb6f04eeb1da5967448d7e831c08c8fa822809f74c720a9";

            // Функция для хеширования строки (SHA-256)
            async function hashSHA256(text) {
                const encoder = new TextEncoder();
                const data = encoder.encode(text);
                const hashBuffer = await crypto.subtle.digest("SHA-256", data);
                const hashArray = Array.from(new Uint8Array(hashBuffer));
                return hashArray.map(byte => byte.toString(16).padStart(2, "0")).join("");
            }

            // Проверка логина и пароля
            loginForm.addEventListener("submit", async (e) => {
                e.preventDefault();

                const username = document.getElementById("username").value;
                const password = document.getElementById("password").value;

                const hashedUsername = await hashSHA256(username);
                const hashedPassword = await hashSHA256(password);

                if (hashedUsername === ADMIN_USERNAME_HASH && hashedPassword === ADMIN_PASSWORD_HASH) {
                    loginContainer.style.display = "none";
                    adminContainer.style.display = "block";
                    loadOrders();
                } else {
                    errorMessage.style.display = "block";
                }
            });

            // Функция загрузки заказов
            function loadOrders() {
                const orders = JSON.parse(localStorage.getItem("orders")) || [];
                const ordersTable = document.querySelector("#orders-table tbody");

                ordersTable.innerHTML = ""; // Очищаем таблицу перед загрузкой

                orders.forEach(order => {
                    const row = document.createElement("tr");
                    row.innerHTML = `
                        <td>${order.username}</td>
                        <td>${order.discord}</td>
                        <td>${order.email}</td>
                        <td>${order.order.map(item => `${item.name} x ${item.quantity}`).join(", ")}</td>
                        <td>$${order.total.toFixed(2)}</td>
                        <td>${order.date}</td>
                    `;
                    ordersTable.appendChild(row);
                });
            }
        });
    </script>
</body>
</html>
